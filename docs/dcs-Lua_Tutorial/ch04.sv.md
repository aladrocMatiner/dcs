# Kapitel 04 ‚Äî Var Lua ‚Äúbor‚Äù i DCS (och var du klistrar in det)

üá¨üáß [English](ch04.md) | üá™üá∏ [Espa√±ol](ch04.es.md) | üá∏üá™ **Svenska** | üá´üáÆ [Suomi](ch04.fi.md)

Till index: [README.sv.md](README.sv.md)

Exempel: [examples/ex04_where_lua_runs.lua](examples/ex04_where_lua_runs.lua)

## Det h√§r l√§r du dig

- De 3 vanligaste st√§llena d√§r uppdrags‚ÄëLua k√∂rs i DCS.
- Vad ‚ÄúMission Scripting Environment (MSE)‚Äù betyder.
- N√§r du ska anv√§nda `DO SCRIPT` vs `DO SCRIPT FILE`.
- En viktig varning: ‚Äúsanitization‚Äù (utan drama).

## S√• anv√§nds det i DCS

T√§nk s√• h√§r: **ditt skript finns i uppdraget**.

DCS k√∂r Lua i uppdrag via **Mission Scripting Environment (MSE)**. D√§r kan du till exempel:

- Visa meddelanden (`trigger.action.outText`)
- L√§sa flags (`trigger.misc.getUserFlag`)
- Skapa F10‚Äëmenyer (`missionCommands...`)
- Lyssna p√• events (`world.addEventHandler`)

Var k√∂rs ditt skript oftast?

1) **Triggers** (vanligast)
   - `DO SCRIPT` (klistra in Lua)
   - `DO SCRIPT FILE` (k√∂r en `.lua`)
2) **AI Tasking**
   - actions som *Script* / *Script File* (k√∂r logik ‚Äúsom en uppgift‚Äù)
3) **Initialization script**
   - k√∂rs mycket tidigt (innan enheter spawna och innan f√∂rsta triggern), beroende p√• mission/server

### S√§kerhetsnot (inga risksteg)

M√•nga installationer har MSE **sanitiserat**:

- Vissa Lua‚Äëlibbar (t.ex. `io`, `os`, `lfs`) kan vara avst√§ngda eller begr√§nsade.
- Det √§r normalt och handlar om s√§kerhet.

Den h√§r kursen ger **inte** instruktioner f√∂r att √§ndra det. Vi skriver skript som fungerar inom normal uppdrags‚Äëmilj√∂.

## Snabbtest (steg f√∂r steg)

M√•l: k√∂ra en fil och se **meddelande p√• sk√§rm** + **loggrad**.

1) √ñppna ditt √∂vningsuppdrag i Mission Editor.
2) G√• till *Triggers*.
3) Skapa trigger:
   - **Type**: `MISSION START`
   - **Action**: `DO SCRIPT FILE`
4) V√§lj: [examples/ex04_where_lua_runs.lua](examples/ex04_where_lua_runs.lua)
5) Spara uppdraget.
6) K√∂r uppdraget.

Du b√∂r se:

- P√• sk√§rm: ‚Äúex04: ...‚Äù
- I logg: en rad med `[DCS-Lua-Tutorial] ex04 loaded ...`

Var hittar du loggen?

- Oftast: `Saved Games\\DCS\\Logs\\dcs.log`

## Vanliga fel och l√∂sningar

- **Inget syns p√• sk√§rmen**:
  - Kontrollera `MISSION START`.
  - Testa `DO SCRIPT` + en enkel `outText` (Kapitel 03).
- **Ingen loggrad**:
  - Hitta `dcs.log` och s√∂k efter `DCS-Lua-Tutorial`.
- **Filen k√∂rs inte**:
  - V√§lj filen igen i `DO SCRIPT FILE`.
  - Spara uppdraget igen.

> **Om du f√•r fel, g√∂r s√• h√§r:**
> - L√§mna bara `outText(...)` (ta bort `env.info`).
> - N√§r det fungerar, l√§gg tillbaka logg.

## Mini‚Äëlab (15‚Äì25 min): ‚Äú√∂vnings‚Äëbasuppdrag‚Äù

M√•l: skapa en mall‚Äëmission du √•teranv√§nder i alla kapitel.

1) Skapa nytt uppdrag (valfri karta).
2) Placera ett spelarflygplan p√• banan.
3) L√§gg `MISSION START` + `DO SCRIPT FILE` och ladda `examples/ex04_where_lua_runs.lua`.
4) Spara som t.ex. `lua_practice_base.miz`.
5) K√∂r och verifiera sk√§rm + logg.

## Checklista (ska synas i spelet)

- Vid start: ett meddelande p√• sk√§rmen (~10s).
- I `dcs.log`: en rad med `ex04 loaded`.

## Navigering

F√∂reg√•ende: [Kapitel 03](ch03.sv.md)  
N√§sta: [Kapitel 05](ch05.sv.md)

