# Luku 04 ‚Äî Miss√§ Lua ‚Äúasuu‚Äù DCS:ss√§ (ja mihin se liimataan)

üá¨üáß [English](ch04.md) | üá™üá∏ [Espa√±ol](ch04.es.md) | üá∏üá™ [Svenska](ch04.sv.md) | üá´üáÆ **Suomi**

Takaisin hakemistoon: [README.fi.md](README.fi.md)

Esimerkki: [examples/ex04_where_lua_runs.lua](examples/ex04_where_lua_runs.lua)

## Mit√§ opit

- 3 yleist√§ paikkaa, joissa teht√§v√§‚ÄëLua ajetaan DCS:ss√§.
- Mit√§ ‚ÄúMission Scripting Environment (MSE)‚Äù tarkoittaa.
- Milloin k√§yt√§t `DO SCRIPT` vs `DO SCRIPT FILE`.
- T√§rke√§ huomio: ‚Äúsanitization‚Äù (turvallisuus).

## Miten sit√§ k√§ytet√§√§n DCS:ss√§

Ajattele n√§in: **skripti on osa teht√§v√§√§**.

DCS ajaa teht√§v√§sriptit ymp√§rist√∂ss√§ nimelt√§ **Mission Scripting Environment (MSE)**. Siell√§ voit esimerkiksi:

- N√§ytt√§√§ viestej√§ (`trigger.action.outText`)
- Lukea flageja (`trigger.misc.getUserFlag`)
- Tehd√§ F10‚Äëvalikoita (`missionCommands...`)
- Kuunnella tapahtumia (`world.addEventHandler`)

Miss√§ skripti ajetaan yleens√§?

1) **Triggerit** (yleisin)
   - `DO SCRIPT`
   - `DO SCRIPT FILE`
2) **AI Tasking**
   - *Script* / *Script File* (logiikka ‚Äúteht√§v√§n√§‚Äù)
3) **Initialization script**
   - hyvin aikaisin (ennen spawnauksia ja ennen ensimm√§ist√§ triggeri√§), riippuen teht√§v√§st√§/palvelimesta

### Turvallisuus (ei riskiohjeita)

Monissa asennuksissa MSE on **sanitisoitu**:

- Osa Lua‚Äëkirjastoista (esim. `io`, `os`, `lfs`) voi olla pois k√§yt√∂st√§ tai rajoitettu.
- T√§m√§ on normaalia ja liittyy turvallisuuteen.

T√§ss√§ tutorialissa emme anna ohjeita t√§m√§n muuttamiseen. Pysymme ‚Äúnormaalin‚Äù teht√§v√§ymp√§rist√∂n rajoissa.

## Pikatesti (vaihe vaiheelta)

Tavoite: aja tiedosto ja n√§e **ruutuviesti** + **logirivi**.

1) Avaa harjoitusteht√§v√§ Mission Editorissa.
2) Mene *Triggers*.
3) Tee trigger:
   - **Type**: `MISSION START`
   - **Action**: `DO SCRIPT FILE`
4) Valitse: [examples/ex04_where_lua_runs.lua](examples/ex04_where_lua_runs.lua)
5) Tallenna ja aja.

Logi l√∂ytyy yleens√§:

- `Saved Games\\DCS\\Logs\\dcs.log`

## Tyypilliset virheet ja ratkaisut

- **Ei n√§y ruudulla**:
  - Varmista `MISSION START`.
  - Testaa ensin pelk√§ll√§ `DO SCRIPT` + `outText` (Luku 03).
- **Ei n√§y logissa**:
  - Etsi `dcs.log` ja hae `DCS-Lua-Tutorial`.
- **Tiedosto ei aja**:
  - Valitse tiedosto uudelleen ja tallenna.

> **Jos tulee virhe, tee n√§in:**
> - Pid√§ vain `outText(...)` (poista `env.info`).
> - Kun se toimii, lis√§√§ logi takaisin.

## Mini‚Äëlab (15‚Äì25 min): harjoittelupohja

Tavoite: tehd√§ ‚Äúpohjateht√§v√§‚Äù, jota k√§yt√§t jokaisessa luvussa.

1) Luo uusi teht√§v√§.
2) Lis√§√§ pelaajakone kiitotielle.
3) Lis√§√§ `MISSION START` + `DO SCRIPT FILE` ja lataa `examples/ex04_where_lua_runs.lua`.
4) Tallenna nimell√§ kuten `lua_practice_base.miz`.
5) Aja ja varmista ruutu + logi.

## Tarkistuslista (n√§kyy peliss√§)

- Teht√§v√§n alussa n√§kyy viesti.
- `dcs.log` sis√§lt√§√§ rivin `ex04 loaded`.

## Navigointi

Edellinen: [Luku 03](ch03.fi.md)  
Seuraava: [Luku 05](ch05.fi.md)

