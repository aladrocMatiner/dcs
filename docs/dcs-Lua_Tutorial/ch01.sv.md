# Kapitel 01 â€” DCS + Lua: vad scriptning mÃ¶jliggÃ¶r (konceptuellt)

ğŸ‡¬ğŸ‡§ [English](ch01.md) | ğŸ‡ªğŸ‡¸ [EspaÃ±ol](ch01.es.md) | ğŸ‡¸ğŸ‡ª **Svenska** | ğŸ‡«ğŸ‡® [Suomi](ch01.fi.md)

Till index: [README.sv.md](README.sv.md)

## MÃ¥l

FÃ¶rstÃ¥ vad DCSâ€‘uppdragsscriptning Ã¤r, varfÃ¶r DCS anvÃ¤nder Lua och vilka problem scriptning kan lÃ¶sa â€” med **minimala snippets** sÃ¥ att du ser kopplingen till verkliga DCSâ€‘fall.

## Vad DCS Ã¤r (pÃ¥ hÃ¶g nivÃ¥)

DCS Ã¤r en stridsflygsimulator dÃ¤r de flesta upplevelser paketeras som **uppdrag (missions)**:

- Ett uppdrag definierar vÃ¤rlden: karta, tid, vÃ¤der, enheter, waypoints, triggers och regler.
- Uppdrag kan vara â€œtrainingâ€, â€œinstant actionâ€, â€œcampaignâ€, multiplayerâ€‘scenarier, osv.

Mission Editor ger dig kraftfulla verktyg utan kod (triggers, flaggor, villkor), och **Luaâ€‘scriptning** anvÃ¤nds nÃ¤r du behÃ¶ver mer flexibilitet.

## Vad â€œscriptningâ€ betyder

Scriptning Ã¤r att **beskriva beteende**: â€œnÃ¤r detta hÃ¤nder, gÃ¶r det hÃ¤râ€.

Det Ã¤r inte samma sak som:

- **Avionikâ€‘kod** (hur flygplanssystemen Ã¤r implementerade)
- **Moddar** (Ã¤ndra assets, cockpit, texturer, flygmodell)

Uppdragsscriptning handlar frÃ¤mst om *scenariologik*.

## VarfÃ¶r DCS anvÃ¤nder Lua (konceptuellt)

DCS anvÃ¤nder Lua fÃ¶r att:

- Det Ã¤r **inbÃ¤ddningsbart** i spelmotorer.
- Det Ã¤r **lÃ¤ttviktigt**: snabb laddning, enkel syntax, lÃ¤tt att distribuera med uppdrag.
- Det Ã¤r **flexibelt** fÃ¶r â€œevent + regler + tillstÃ¥ndâ€.

Du behÃ¶ver inte vara utvecklare fÃ¶r att dra nytta av det. TÃ¤nk pÃ¥ Lua som ett sÃ¤tt att gÃ¶ra uppdrag â€œreaktivaâ€ istÃ¤llet fÃ¶r â€œstatiskaâ€.

## Vad du kan gÃ¶ra med DCS Luaâ€‘scriptning (konceptuella exempel)

Exemplen nedan Ã¤r medvetet **konceptuella** â€” i praktiken kan du lÃ¶sa dem med Mission Editorâ€‘triggers, med Lua, eller med en blandning.

### 1) TrÃ¤ning och undervisning

- Stegâ€‘fÃ¶râ€‘stegâ€‘instruktioner (â€œNu stÃ¤ll in Xâ€, â€œBraâ€, â€œFÃ¶rsÃ¶k igenâ€).
- Anpassade lektioner: feedback om eleven Ã¤r fÃ¶r snabb/lÃ¥ngsam/fÃ¶r hÃ¶g.
- Repetitiva Ã¶vningar (t.ex. â€œ3 fÃ¶rsÃ¶kâ€, tidtagning, poÃ¤ng).

### 2) Reagera pÃ¥ hÃ¤ndelser och driva berÃ¤ttelsen

- NÃ¤r en enhet startar/landar: uppdatera mÃ¥l eller lÃ¥s upp nÃ¤sta fas.
- NÃ¤r ett mÃ¥l fÃ¶rstÃ¶rs: ny uppgift, fÃ¶rstÃ¤rkningar, nya radiomeddelanden.
- NÃ¤r spelaren gÃ¥r in i en zon: starta timer, checkpoint eller bakhÃ¥ll.

### 3) FlÃ¶de och progression (tillstÃ¥nd/flagor)

Lua passar nÃ¤r du vill att uppdraget beter sig som en **tillstÃ¥ndsmaskin**:

- Fas 1 â†’ Fas 2 â†’ Fas 3, baserat pÃ¥ vad som faktiskt hÃ¤nder.
- PoÃ¤ng, misslyckanden, delvis framgÃ¥ng och fÃ¶rgreningar.
- â€œProgressâ€‘kÃ¤nslaâ€ inom en session.

### 4) AI och gruppkontroll (pÃ¥ hÃ¶g nivÃ¥)

- Aktivera grupper endast nÃ¤r de behÃ¶vs (prestanda och tempo).
- Skala hot gradvis.
- Skicka AIâ€‘uppgifter dynamiskt (patruller, intercept, eskort).

### 5) Tid, timers och tempo

- HÃ¤ndelser efter en fÃ¶rdrÃ¶jning (â€œom fortfarande i liv efter 5 minâ€¦â€).
- Periodiska kontroller (â€œvar 10:e sekund, utvÃ¤rdera villkorâ€).
- VÃ¥gor, Ã¥terhÃ¤mtningsfÃ¶nster och tidsmÃ¥l.

### 6) Kommunikation och immersion

- Dynamiska briefingâ€‘uppdateringar.
- Kontextmeddelanden (â€œRTBâ€, â€œdivertâ€, â€œhot detectedâ€).
- â€œRadioâ€‘kÃ¤nslaâ€ med tidsstyrda meddelanden och villkor.

### 7) Hemmabyggda cockpitar och multiâ€‘monitor (Lua, men inte uppdragsscriptning)

DCS anvÃ¤nder Ã¤ven Lua utanfÃ¶r â€œuppdragslogikâ€. FÃ¶r hemmacockpitar och multiâ€‘monitorâ€‘upplÃ¤gg Ã¤r Lua ofta inblandat i:

- **SkÃ¤rmkonfiguration** (Luaâ€‘baserade monitor setupâ€‘filer) fÃ¶r att placera exporterade viewports pÃ¥ andra skÃ¤rmar.
- **Export av instrument/skÃ¤rmar** (beror pÃ¥ flygplanet): mÃ¥nga moduler kan exportera MFD:er och andra repeaters; **vissa moduler kan ha HUDâ€‘viewport eller andra displayâ€‘viewports**, men det Ã¤r inte universellt.
- **Exportâ€‘integration** (t.ex. `Export.lua`) fÃ¶r att skicka data till externa appar/hÃ¥rdvara (Helios, Arduino/USBâ€‘paneler, egna dashboards).

Praktiskt exempel (konceptuellt): ett tvÃ¥skÃ¤rmsâ€‘upplÃ¤gg dÃ¤r huvudskÃ¤rmen Ã¤r utsikten och en andra skÃ¤rm visar exporterade cockpitdisplayer (t.ex. MFD/RWR) och trÃ¤ningsmeddelanden, vilket fÃ¶rbÃ¤ttrar lÃ¤sbarhet och kÃ¤nns mer som en fysisk trainer.

## Lua i DCS: var det kÃ¶rs och hur du anvÃ¤nder det

I DCS anvÃ¤nds Lua frÃ¤mst i **Mission Scripting Environment (MSE)**: miljÃ¶n dÃ¤r uppdragets logik kÃ¶rs.

- Vanligast Ã¤r att kÃ¶ra det frÃ¥n **Mission Editor**, via triggerâ€‘actions som `DO SCRIPT` och `DO SCRIPT FILE`.
- Du ser det ocksÃ¥ som â€œinit/startâ€‘scriptâ€ (t.ex. pÃ¥ *Mission Start*) fÃ¶r att registrera event handlers, skapa F10â€‘menyer eller initiera tillstÃ¥nd.
- MSE Ã¤r inte â€œfri Luaâ€: det Ã¤r en kontrollerad miljÃ¶ med DCSâ€‘API (enheter, events, actions, osv.) och begrÃ¤nsningar fÃ¶r sÃ¤kerhet/stabilitet.
- Konceptuellt Ã¤r detta nÃ¥got annat Ã¤n `Export.lua`: **Export** kÃ¶r pÃ¥ klienten (utanfÃ¶r uppdraget) fÃ¶r att exportera data till appar/hÃ¥rdvara. Vi nÃ¤mner det hÃ¤r bara som kontext.

Det praktiska arbetsflÃ¶det kommer i Kapitel 02. NyckelidÃ©n Ã¤r:

- Scriptning Ã¤r en del av **uppdragets logiklager**.
- Du itererar: Ã¤ndra â†’ kÃ¶r â†’ observera â†’ justera.

## Praktiska fall (nybÃ¶rjarnivÃ¥)

MÃ¥let hÃ¤r Ã¤r inte att lÃ¤ra hela API:t â€” utan att kÃ¤nna igen mÃ¶nster som anvÃ¤nds i uppdrag och servrar.

### A) Event handler + meddelanden (rÃ¤kna kills och visa â€œscoreâ€)

Ett vanligt mÃ¶nster Ã¤r att lyssna pÃ¥ hÃ¤ndelser i vÃ¤rlden (start, landning, trÃ¤ffar, killsâ€¦) och reagera med egen logik.
Det passar fÃ¶r trÃ¤ning, utvÃ¤rdering, enkla â€œscoreboardsâ€ och snabb Ã¥terkoppling i uppdraget.

```lua
local score = { kills = 0 }

world.addEventHandler({
  onEvent = function(self, event)
    if event.id == world.event.S_EVENT_KILL then
      score.kills = score.kills + 1
      trigger.action.outText("Kills: " .. score.kills, 5)
    end
  end
})
```

Vad du lÃ¤r dig: loopen **â€œevent â†’ logik â†’ feedbackâ€** (och att fÃ¶rst bevisa att det kÃ¶rs).

### B) Enkel F10â€‘meny (knappar i uppdraget)

F10â€‘menyn Ã¤r snabbâ€‘UI i mÃ¥nga uppdrag: reset av trÃ¤ning, spawn av mÃ¥l, info, smokeâ€‘markering, osv.
Den Ã¤r bra fÃ¶r instruktÃ¶rer/piloter eftersom den ger sÃ¤kra, repetitiva actions pÃ¥ begÃ¤ran.

```lua
local menu = missionCommands.addSubMenu("TrÃ¤ning")

missionCommands.addCommand("Visa score", menu, function()
  trigger.action.outText("Kills: " .. (score and score.kills or 0), 5)
end)
```

Vad du lÃ¤r dig: ge spelaren **kontroll** utan komplicerade triggerâ€‘nÃ¤t.

### C) GrundlÃ¤ggande â€œspawnâ€ utan frameworks (aktivera fÃ¶rplacerade grupper)

Innan du gÃ¥r pÃ¥ MIST/MOOSE Ã¤r en vanlig â€œspawnâ€â€‘metod att fÃ¶rplacera grupper (t.ex. **Late Activation**) och aktivera dem vid behov.
Det Ã¤r robust, men krÃ¤ver rÃ¤tt uppdragssetup och exakta namn.

```lua
local function activateByName(groupName)
  local group = Group.getByName(groupName)
  if group then
    trigger.action.activateGroup(group)
    trigger.action.outText("Aktiverad: " .. groupName, 5)
  else
    trigger.action.outText("Hittar inte grupp: " .. groupName, 5)
  end
end
```

Vad du lÃ¤r dig: workflow **â€œfÃ¶rbered i editor â†’ aktivera med Luaâ€** (namn + tempo).

### D) (IdÃ©) F10â€‘markÃ¶rer som â€œkommandonâ€ (admin/trÃ¤ning)

PÃ¥ trÃ¤ningsservrar anvÃ¤nds ofta mÃ¶nstret â€œlÃ¤gg en markÃ¶r med text och scriptet gÃ¶r nÃ¥gotâ€.
Du behÃ¶ver inget framework fÃ¶r att fÃ¶rstÃ¥ idÃ©n: en markÃ¶r Ã¤r anvÃ¤ndarinput (text + position) och din Lua vÃ¤ljer action.

```lua
world.addEventHandler({
  onEvent = function(self, e)
    if e.id == world.event.S_EVENT_MARK_ADDED and e.text == "smoke" then
      trigger.action.smoke(e.pos, trigger.smokeColor.Red)
      trigger.action.outText("RÃ¶k vid markÃ¶r.", 5)
    end
  end
})
```

Vad du lÃ¤r dig: gÃ¶ra spelarbeteende till **enkla â€œadminâ€‘kommandonâ€**.

## Miniâ€‘projekt (20â€“30 min)

MÃ¥l: **â€œF10â€‘trÃ¤ning: spawn 3 mÃ¥l + reset + scoreâ€**.

1) I Mission Editor, skapa 3 mÃ¥lgrupper med namnen `TGT_01`, `TGT_02`, `TGT_03` och sÃ¤tt dem till **Late Activation**.
2) Skapa en *Mission Start*â€‘trigger med `DO SCRIPT` (eller `DO SCRIPT FILE`) fÃ¶r att ladda ditt script.
3) LÃ¤gg till `score = { kills = 0 }` och en `world.addEventHandler` som Ã¶kar kills vid `S_EVENT_KILL`.
4) Skapa en F10â€‘meny som heter â€œTrÃ¤ningâ€.
5) LÃ¤gg till kommandon `Spawn TGT_01/02/03` som anropar `activateByName("TGT_01")`, osv.
6) LÃ¤gg till `Visa score` som anvÃ¤nder `trigger.action.outText(...)`.
7) LÃ¤gg till `Reset` som (tills vidare) bara sÃ¤tter `score.kills = 0` och visar ett meddelande.
8) Testa: starta uppdraget, spawna mÃ¥l via F10, fÃ¶rstÃ¶r ett och bekrÃ¤fta att rÃ¤knaren Ã¶kar.

Checklista (i spelet):
- F10â€‘menyn â€œTrÃ¤ningâ€ syns.
- â€œSpawn TGT_01/02/03â€ visar â€œAktiveradâ€¦â€.
- Efter att du fÃ¶rstÃ¶rt ett mÃ¥l ser du `Kills: X`.
- â€œResetâ€ Ã¥terstÃ¤ller rÃ¤knaren till 0.

## Debugâ€‘tÃ¤nk (utan verktyg Ã¤nnu)

De flesta problem Ã¤r inte â€œsvÃ¥ra buggarâ€; oftast handlar det om:

- Triggern kÃ¶rdes inte.
- Namn stÃ¤mmer inte (grupp/zon/enhet).
- HÃ¤ndelser kom i annan ordning Ã¤n du trodde.

FÃ¶rsta vanan: **bevisa att logiken kÃ¶rdes** (sedan fÃ¶rbÃ¤ttra beteendet).

## Vanliga misstag (och hur du tÃ¤nker kring dem)

- **Ingenting hÃ¤nder**: anta att triggern inte kÃ¶rdes.
- **Fel grupp/enhet**: namn mÃ¥ste matcha exakt.
- **FÃ¶r mycket pÃ¥ en gÃ¥ng**: bÃ¶rja med en sak, bygg sedan vidare.
- **Blanda ansvar**: skilj mentalt pÃ¥ â€œdetekteraâ€ och â€œageraâ€.

## Avancerade integrationer (senare)

- **Persistens / integrationer utanfÃ¶r uppdraget**: att spara tillstÃ¥nd eller prata med externa system innebÃ¤r ofta I/O, vilket Ã¤r **begrÃ¤nsat i DCS av sÃ¤kerhetsskÃ¤l**; att Ã¤ndra `MissionScripting.lua` fÃ¶r att desâ€‘sanitiza Ã¤r kÃ¤nsligt och riskabelt om du inte kontrollerar vilken kod som kÃ¶rs.
- **SRS / ATIS / TTS**: mÃ¥nga communities kopplar uppdragslogik till radio/automation (se det som ekosystem, inte krav).
- **`Export.lua`**: bra fÃ¶r hemmacockpitar, telemetri och externa appar; det Ã¤r ett annat lager Ã¤n MSE.

## NÃ¤sta steg

Kapitel 02 tÃ¤cker:

- En praktisk pipeline (VS Code).
- Vad du behÃ¶ver (och inte behÃ¶ver) installera.
- Vanliga bibliotek (MIST/MOOSE och andra) och nÃ¤r de hjÃ¤lper.

## Navigering

NÃ¤sta: [Kapitel 02](ch02.sv.md)
