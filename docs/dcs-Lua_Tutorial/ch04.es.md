# Cap√≠tulo 04 ‚Äî D√≥nde vive Lua en DCS (y d√≥nde pegarlo sin liarte)

üá¨üáß English (pendiente) | üá™üá∏ **Espa√±ol** | üá∏üá™ Svenska (pendiente) | üá´üáÆ Suomi (pendiente)

Volver al √≠ndice: [README.es.md](README.es.md)

Ejemplo del cap√≠tulo: [examples/ex04_where_lua_runs.lua](examples/ex04_where_lua_runs.lua)

## Qu√© vas a aprender

- Los 3 sitios t√≠picos donde ‚Äúarranca‚Äù Lua en DCS (en misiones).
- Qu√© significa ‚ÄúMission Scripting Environment (MSE)‚Äù.
- Cu√°ndo usar `DO SCRIPT` y cu√°ndo `DO SCRIPT FILE`.
- Una advertencia importante: ‚Äúsanitizaci√≥n‚Äù (sin miedo, pero con cabeza).

## C√≥mo se usa en DCS

Piensa as√≠: **tu script vive en tu misi√≥n**.

DCS tiene un entorno interno para scripts de misi√≥n llamado **Mission Scripting Environment (MSE)**. Es donde pasan estas cosas:

- Puedes mostrar mensajes (`trigger.action.outText`).
- Puedes leer flags (`trigger.misc.getUserFlag`).
- Puedes crear men√∫s F10 (`missionCommands...`).
- Puedes escuchar eventos (`world.addEventHandler`).

¬øD√≥nde se ejecuta tu script normalmente?

1) **Triggers** (lo m√°s com√∫n)
   - `DO SCRIPT` (pegas Lua)
   - `DO SCRIPT FILE` (ejecutas un `.lua`)
2) **AI Tasking**
   - acciones tipo *Script* / *Script File* (para ejecutar l√≥gica ‚Äúcomo tarea‚Äù)
3) **Initialization script**
   - se ejecuta muy pronto (antes de que spawneen unidades y antes del primer trigger), seg√∫n misi√≥n/servidor

### Nota de seguridad (sin entrar en cosas raras)

En muchas instalaciones, el entorno de misi√≥n est√° **sanitizado**. Eso significa:

- Algunas librer√≠as de Lua (como `io`, `os`, `lfs`) pueden estar deshabilitadas.
- Es normal. Es por seguridad.

En este tutorial **no** vamos a tocar nada para cambiar eso. Dise√±aremos scripts que funcionen sin depender de acceso a archivos externos.

## Prueba r√°pida (paso a paso)

Objetivo: ejecutar un archivo y ver **mensaje en pantalla** + **mensaje en log**.

1) En el Mission Editor, crea/abre una misi√≥n simple.
2) Ve a *Triggers*.
3) Crea un trigger:
   - **Type**: `MISSION START`
   - **Action**: `DO SCRIPT FILE`
4) Selecciona: [examples/ex04_where_lua_runs.lua](examples/ex04_where_lua_runs.lua)
5) Guarda la misi√≥n.
6) Ejecuta la misi√≥n.

Qu√© deber√≠as notar:

- En pantalla: ‚Äúex04: Este script se ejecut√≥ (MSE).‚Äù
- En logs: una l√≠nea con `[DCS-Lua-Tutorial] ex04 loaded ...`

D√≥nde ver el log:

- Normalmente en `Saved Games\\DCS\\Logs\\dcs.log`

## Errores t√≠picos y soluci√≥n

- **No aparece el mensaje en pantalla**:
  - Aseg√∫rate de que el trigger es `MISSION START`.
  - Prueba primero con `DO SCRIPT` pegando `outText` (Cap√≠tulo 03).
- **No veo nada en el log**:
  - Busca `dcs.log` en tu `Saved Games`.
  - Usa el buscador dentro del archivo y busca `DCS-Lua-Tutorial`.
- **El archivo no se ejecuta**:
  - Vuelve a seleccionar el archivo en `DO SCRIPT FILE`.
  - Guarda la misi√≥n de nuevo.

> **Si te sale error, haz esto:**
> - Deja solo el `trigger.action.outText(...)` (sin `env.info`).
> - Si eso funciona, a√±ade el log despu√©s.

## Mini‚Äëlab (15‚Äì25 min): ‚Äúmisi√≥n base de pr√°ctica‚Äù

Objetivo: tener una misi√≥n ‚Äúplantilla‚Äù que usar√°s en todo el tutorial.

1) Crea una misi√≥n nueva (cualquier mapa).
2) Pon un avi√≥n jugador en pista.
3) Crea un trigger `MISSION START` con `DO SCRIPT FILE` y carga `examples/ex04_where_lua_runs.lua`.
4) Guarda la misi√≥n con un nombre tipo `lua_practica_base.miz`.
5) Ejecuta y confirma pantalla + log.

En adelante, clona esta misi√≥n para practicar cada cap√≠tulo.

## Checklist (debe verse en el juego)

- Al empezar, ves un mensaje en pantalla (10 s).
- En `dcs.log` aparece una l√≠nea con `ex04 loaded`.

## Navegaci√≥n

Anterior: [Cap√≠tulo 03](ch03.es.md)  
Siguiente: [Cap√≠tulo 05](ch05.es.md)

