# Luku 01 â€” DCS + Lua: mitÃ¤ skriptaus mahdollistaa (kÃ¤sitteellinen)

ğŸ‡¬ğŸ‡§ [English](ch01.md) | ğŸ‡ªğŸ‡¸ [EspaÃ±ol](ch01.es.md) | ğŸ‡¸ğŸ‡ª [Svenska](ch01.sv.md) | ğŸ‡«ğŸ‡® **Suomi**

Takaisin hakemistoon: [README.fi.md](README.fi.md)

## Tavoite

YmmÃ¤rtÃ¤Ã¤, mitÃ¤ DCSâ€‘tehtÃ¤vien skriptaus on, miksi DCS kÃ¤yttÃ¤Ã¤ Luaa ja millaisia ongelmia skriptauksella voidaan ratkaista â€” **minimaalisilla esimerkkipÃ¤tkillÃ¤**, jotta nÃ¤et yhteyden oikeisiin DCSâ€‘kÃ¤yttÃ¶tapauksiin.

## MikÃ¤ DCS on (yleistaso)

DCS on taistelulentosimulaattori, jossa suurin osa kokemuksista on **tehtÃ¤viÃ¤ (missions)**:

- TehtÃ¤vÃ¤ mÃ¤Ã¤rittÃ¤Ã¤ maailman: kartta, aika, sÃ¤Ã¤, yksikÃ¶t, reittipisteet, triggerit ja sÃ¤Ã¤nnÃ¶t.
- TehtÃ¤vÃ¤t voivat olla â€œtrainingâ€, â€œinstant actionâ€, â€œcampaignâ€, moninpeliskenaarioita jne.

Mission Editor tarjoaa tehokkaat â€œilman koodiaâ€ â€‘tyÃ¶kalut (triggerit, liput, ehdot), ja **Luaâ€‘skriptaus** tulee kuvaan, kun tarvitaan enemmÃ¤n joustavuutta.

## MitÃ¤ â€œskriptausâ€ tarkoittaa

Skriptaus on **kÃ¤yttÃ¤ytymisen kuvaamista**: â€œkun tÃ¤mÃ¤ tapahtuu, tee tuoâ€.

Se ei ole sama asia kuin:

- **Avioniikan koodaus** (miten koneen jÃ¤rjestelmÃ¤t on toteutettu)
- **Modit** (assetit, ohjaamot, tekstuurit, lentomallit)

TehtÃ¤vÃ¤sriptaus koskee ennen kaikkea *skenaarion logiikkaa*.

## Miksi DCS kÃ¤yttÃ¤Ã¤ Luaa (kÃ¤sitteellisesti)

DCS kÃ¤yttÃ¤Ã¤ Luaa, koska se on:

- **Sulautettava** pelimoottoriin.
- **Kevyt**: nopea ladata, yksinkertainen syntaksi, helppo jakaa tehtÃ¤vÃ¤n mukana.
- **Joustava** â€œtapahtuma + sÃ¤Ã¤nnÃ¶t + tilaâ€ â€‘logiikkaan.

Sinun ei tarvitse olla ohjelmistokehittÃ¤jÃ¤ hyÃ¶tyÃ¤ksesi tÃ¤stÃ¤. Ajattele Luaa tapana tehdÃ¤ tehtÃ¤vistÃ¤ â€œreaktiivisiaâ€ eikÃ¤ vain â€œstaattisiaâ€.

## MitÃ¤ DCS Luaâ€‘skriptauksella voi tehdÃ¤ (kÃ¤sitteellisiÃ¤ esimerkkejÃ¤)

Alla olevat esimerkit ovat tarkoituksella **kÃ¤sitteellisiÃ¤** â€” kÃ¤ytÃ¤nnÃ¶ssÃ¤ voit toteuttaa ne Mission Editorin triggereillÃ¤, Lualla tai nÃ¤iden yhdistelmÃ¤llÃ¤.

### 1) Koulutus ja opetus

- Vaiheittaiset ohjeet (â€œNyt aseta Xâ€, â€œHyvÃ¤â€, â€œYritÃ¤ uudelleenâ€).
- Mukautuva palaute: jos oppilas on liian nopea/hidas/liian korkealla.
- Toistettavat harjoitukset (esim. â€œ3 yritystÃ¤â€, ajastus, pisteytys).

### 2) Tapahtumiin reagointi ja tarinan kuljetus

- Kun yksikkÃ¶ nousee/laskeutuu: pÃ¤ivitÃ¤ tavoitteet tai avaa seuraava vaihe.
- Kun kohde tuhoutuu: uusi tehtÃ¤vÃ¤, vahvistukset, radioviestit.
- Kun pelaaja menee vyÃ¶hykkeelle: kÃ¤ynnistÃ¤ ajastin, checkpoint tai vÃ¤ijytys.

### 3) Kulku ja eteneminen (tila/liput)

Lua on hyÃ¶dyllinen, kun haluat tehtÃ¤vÃ¤n toimivan kuin **tilakone**:

- Vaihe 1 â†’ Vaihe 2 â†’ Vaihe 3 sen mukaan mitÃ¤ oikeasti tapahtuu.
- Pisteytys, epÃ¤onnistumisehdot, osittainen onnistuminen ja haarautuminen.
- â€œEtenemisenâ€ tuntu yhden session aikana.

### 4) AI ja ryhmien hallinta (yleistaso)

- Aktivoi ryhmiÃ¤ vain tarpeen mukaan (suorituskyky ja tempo).
- LisÃ¤Ã¤ uhkia asteittain.
- TyÃ¶nnÃ¤ AIâ€‘tehtÃ¤viÃ¤ dynaamisesti (partiot, sieppaukset, saattueet).

### 5) Aika, ajastimet ja rytmi

- Tapahtumat viiveellÃ¤ (â€œjos yhÃ¤ elossa 5 min jÃ¤lkeenâ€¦â€).
- SÃ¤Ã¤nnÃ¶lliset tarkistukset (â€œ10 sekunnin vÃ¤lein, arvioi ehdotâ€).
- Aallot, palautumisikkunat ja aikarajalliset tavoitteet.

### 6) ViestintÃ¤ ja immersio

- Dynaamiset briefingâ€‘pÃ¤ivitykset.
- Tilannekohtaiset viestit (â€œRTBâ€, â€œdivertâ€, â€œuhka havaittuâ€).
- â€œRadioâ€‘fiilisâ€ ajastetuilla viesteillÃ¤ ja ehdoilla.

### 7) Kotiohjaamot ja usean nÃ¤ytÃ¶n asetukset (Lua, mutta ei tehtÃ¤vÃ¤logiikkaa)

DCS kÃ¤yttÃ¤Ã¤ Luaa myÃ¶s â€œtehtÃ¤vÃ¤logiikanâ€ ulkopuolella. Kotiohjaamoissa ja moninÃ¤yttÃ¶asetuksissa Lua liittyy usein:

- **NÃ¤yttÃ¶asetuksiin** (Luaâ€‘pohjaiset monitor setup â€‘tiedostot), joilla exporteratut viewports asetellaan muille nÃ¤ytÃ¶ille.
- **Mittareiden/nÃ¤yttÃ¶jen exportiin** (riippuu koneesta): monet moduulit voivat exportata MFDâ€‘nÃ¤yttÃ¶jÃ¤ ja muita repeatereita; **joissain moduuleissa voi olla HUDâ€‘viewport tai muita displayâ€‘viewporteja**, mutta tÃ¤mÃ¤ ei ole yleispÃ¤tevÃ¤.
- **Exportâ€‘integraatioon** (esim. `Export.lua`) datan lÃ¤hettÃ¤miseksi ulkoisiin sovelluksiin/laitteisiin (Helios, Arduino/USBâ€‘paneelit, omat dashboardit).

KÃ¤ytÃ¤nnÃ¶n esimerkki (kÃ¤sitteellinen): kahden nÃ¤ytÃ¶n kokonaisuus, jossa pÃ¤Ã¤ruutu on ulkonÃ¤kymÃ¤ ja toinen nÃ¤yttÃ¶ nÃ¤yttÃ¤Ã¤ exporteratut ohjaamonÃ¤ytÃ¶t (esim. MFD/RWR) sekÃ¤ harjoitusviestit â€” luettavuus paranee ja kotiohjaamo tuntuu lÃ¤hempÃ¤nÃ¤ oikeaa koulukonetta.

## Lua DCS:ssÃ¤: missÃ¤ se ajetaan ja miten sitÃ¤ kÃ¤ytetÃ¤Ã¤n

DCS:ssÃ¤ Luaa kÃ¤ytetÃ¤Ã¤n pÃ¤Ã¤asiassa **Mission Scripting Environmentissa (MSE)**: ympÃ¤ristÃ¶ssÃ¤, jossa tehtÃ¤vÃ¤n logiikka suoritetaan.

- Yleisin tapa on ajaa sitÃ¤ **Mission Editorista**, triggerâ€‘toiminnoilla kuten `DO SCRIPT` ja `DO SCRIPT FILE`.
- NÃ¤et sitÃ¤ myÃ¶s â€œinit/startâ€‘skripteinÃ¤â€ (esim. *Mission Start*), joilla rekisterÃ¶idÃ¤Ã¤n event handlerit, rakennetaan F10â€‘valikoita tai alustetaan tilaa.
- MSE ei ole â€œvapaa Luaâ€: se on hallittu ympÃ¤ristÃ¶, jossa on DCSâ€‘API (yksikÃ¶t, tapahtumat, toiminnot, jne.) ja rajoituksia turvallisuuden/vakauden takia.
- KÃ¤sitteellisesti tÃ¤mÃ¤ eroaa `Export.lua`:sta: **Export** ajetaan asiakkaalla (tehtÃ¤vÃ¤n ulkopuolella) datan viemiseksi sovelluksiin/laitteisiin. Mainitsemme sen tÃ¤ssÃ¤ vain kontekstina.

KÃ¤ytÃ¤nnÃ¶n tyÃ¶putki tulee Luvussa 02. TÃ¤rkein ajatus:

- Skriptaus on osa **tehtÃ¤vÃ¤n logiikkakerrosta**.
- Iteroit nÃ¤in: muutos â†’ ajo â†’ havainnointi â†’ sÃ¤Ã¤tÃ¶.

## KÃ¤ytÃ¤nnÃ¶n esimerkit (alkutaso)

Tavoite ei ole oppia koko APIa â€” vaan tunnistaa oikeita kuvioita, joita tehtÃ¤vissÃ¤ ja palvelimilla kÃ¤ytetÃ¤Ã¤n.

### A) Event handler + viestit (laske tappoja ja nÃ¤ytÃ¤ â€œscoreâ€)

Hyvin yleinen kuvio on kuunnella maailman tapahtumia (nousu, lasku, osumat, tapotâ€¦) ja reagoida omalla logiikalla.
TÃ¤tÃ¤ kÃ¤ytetÃ¤Ã¤n koulutuksessa, arvioinnissa, yksinkertaisissa â€œscoreboardeissaâ€ ja nopeassa palautteessa tehtÃ¤vÃ¤n aikana.

```lua
local score = { kills = 0 }

world.addEventHandler({
  onEvent = function(self, event)
    if event.id == world.event.S_EVENT_KILL then
      score.kills = score.kills + 1
      trigger.action.outText("Kills: " .. score.kills, 5)
    end
  end
})
```

MitÃ¤ opit: silmukka **â€œtapahtuma â†’ logiikka â†’ palauteâ€** (ja miksi ensin pitÃ¤Ã¤ todistaa, ettÃ¤ koodi ylipÃ¤Ã¤nsÃ¤ ajetaan).

### B) Yksinkertainen F10â€‘valikko (tehtÃ¤vÃ¤painikkeet)

F10â€‘radioâ€‘valikko on monen tehtÃ¤vÃ¤n pikakÃ¤yttÃ¶liittymÃ¤: harjoituksen reset, kohteiden aktivointi/spawn, info, savumerkki, jne.
Se sopii hyvin kouluttajille ja piloteille, koska se antaa turvallisia ja toistettavia toimintoja pyynnÃ¶stÃ¤.

```lua
local menu = missionCommands.addSubMenu("Harjoittelu")

missionCommands.addCommand("NÃ¤ytÃ¤ score", menu, function()
  trigger.action.outText("Kills: " .. (score and score.kills or 0), 5)
end)
```

MitÃ¤ opit: miten **annat pelaajalle hallinnan** ilman monimutkaista triggerâ€‘spagettia.

### C) Perus â€œspawnâ€ ilman frameworkeja (aktivoi valmiiksi sijoitetut ryhmÃ¤t)

Ennen kuin siirryt MIST/MOOSEen, yleinen â€œspawnâ€â€‘tapa on sijoittaa ryhmÃ¤t valmiiksi (esim. **Late Activation**) ja aktivoida ne tarpeen mukaan.
TÃ¤mÃ¤ on robusti lÃ¤hestymistapa, mutta se vaatii oikean tehtÃ¤vÃ¤asetelman ja tÃ¤smÃ¤lliset nimet.

```lua
local function activateByName(groupName)
  local group = Group.getByName(groupName)
  if group then
    trigger.action.activateGroup(group)
    trigger.action.outText("Aktivoitu: " .. groupName, 5)
  else
    trigger.action.outText("RyhmÃ¤Ã¤ ei lÃ¶ydy: " .. groupName, 5)
  end
end
```

MitÃ¤ opit: tyÃ¶nkulku **â€œvalmistele editorissa â†’ aktivoi Luallaâ€** (nimet + tempo).

### D) (Idea) F10â€‘karttamerkit â€œkomentoinaâ€ (admin/koulutus)

Koulutuspalvelimilla kÃ¤ytetÃ¤Ã¤n paljon mallia â€œlisÃ¤Ã¤ karttamerkki tekstillÃ¤, ja skripti tekee jotainâ€.
Et tarvitse frameworkia ymmÃ¤rtÃ¤Ã¤ksesi idean: merkki on kÃ¤yttÃ¤jÃ¤n syÃ¶te (teksti + sijainti) ja Lua valitsee toiminnon.

```lua
world.addEventHandler({
  onEvent = function(self, e)
    if e.id == world.event.S_EVENT_MARK_ADDED and e.text == "smoke" then
      trigger.action.smoke(e.pos, trigger.smokeColor.Red)
      trigger.action.outText("Savu merkissÃ¤.", 5)
    end
  end
})
```

MitÃ¤ opit: miten pelaajan toiminnasta tehdÃ¤Ã¤n **yksinkertaisia â€œadminâ€‘komentojaâ€**.

## Miniâ€‘projekti (20â€“30 min)

Tavoite: **â€œF10â€‘harjoittelu: spawn 3 maalia + reset + scoreâ€**.

1) Mission Editorissa luo 3 maaliryhmÃ¤Ã¤ nimillÃ¤ `TGT_01`, `TGT_02`, `TGT_03` ja aseta ne **Late Activation** â€‘tilaan.
2) Luo *Mission Start* â€‘trigger, jossa on `DO SCRIPT` (tai `DO SCRIPT FILE`) skriptin lataamiseksi.
3) LisÃ¤Ã¤ `score = { kills = 0 }` ja `world.addEventHandler`, joka kasvattaa tappoja `S_EVENT_KILL`â€‘tapahtumasta.
4) Luo F10â€‘valikko nimellÃ¤ â€œHarjoitteluâ€.
5) LisÃ¤Ã¤ komennot `Spawn TGT_01/02/03`, jotka kutsuvat `activateByName("TGT_01")`, jne.
6) LisÃ¤Ã¤ komento `NÃ¤ytÃ¤ score`, joka kÃ¤yttÃ¤Ã¤ `trigger.action.outText(...)`.
7) LisÃ¤Ã¤ komento `Reset`, joka (toistaiseksi) vain asettaa `score.kills = 0` ja tulostaa viestin.
8) Testaa: kÃ¤ynnistÃ¤ tehtÃ¤vÃ¤, aktivoi maalit F10:llÃ¤, tuhoa yksi ja varmista ettÃ¤ laskuri kasvaa.

Checklist (pelissÃ¤):
- F10â€‘valikko â€œHarjoitteluâ€ nÃ¤kyy.
- â€œSpawn TGT_01/02/03â€ nÃ¤yttÃ¤Ã¤ â€œAktivoituâ€¦â€.
- Maalin tuhouduttua nÃ¤et `Kills: X`.
- â€œResetâ€ palauttaa laskurin nollaan.

## Debugâ€‘ajattelu (ilman tyÃ¶kaluja vielÃ¤)

Useimmat ongelmat eivÃ¤t ole â€œvaikeita bugejaâ€; tyypillisesti:

- Trigger ei lauennut.
- Nimi ei tÃ¤smÃ¤nnyt (ryhmÃ¤/vyÃ¶hyke/yksikkÃ¶).
- Tapahtumien jÃ¤rjestys oli eri kuin oletit.

EnsimmÃ¤inen tapa: **todista ettÃ¤ logiikka ajettiin** (ja paranna sitten kÃ¤ytÃ¶stÃ¤).

## YleisiÃ¤ virheitÃ¤ (ja miten niistÃ¤ kannattaa ajatella)

- **MitÃ¤Ã¤n ei tapahdu**: oleta ettÃ¤ trigger ei ajanut.
- **VÃ¤Ã¤rÃ¤ ryhmÃ¤/yksikkÃ¶**: nimien pitÃ¤Ã¤ tÃ¤smÃ¤tÃ¤ tarkasti.
- **Liikaa kerralla**: aloita yhdestÃ¤ asiasta ja laajenna.
- **Vastuiden sekoitus**: erottele â€œhavaintoâ€ ja â€œtoimintaâ€.

## Edistyneet integraatiot (myÃ¶hemmin)

- **Pysyvyys / integraatiot tehtÃ¤vÃ¤n ulkopuolelle**: tilan tallentaminen tai ulkoisiin jÃ¤rjestelmiin puhuminen tarkoittaa usein I/O:ta, joka on **rajoitettu DCS:ssÃ¤ turvallisuussyistÃ¤**; `MissionScripting.lua`:n muokkaaminen (desanitize) on herkkÃ¤Ã¤ ja riskialtista, jos et tÃ¤ysin hallitse mitÃ¤ koodia ajetaan.
- **SRS / ATIS / TTS**: monet yhteisÃ¶t yhdistÃ¤vÃ¤t tehtÃ¤vÃ¤logiikkaa puhe- ja automaatioratkaisuihin (ajattele tÃ¤tÃ¤ â€œekosysteeminÃ¤â€, ei vaatimuksena).
- **`Export.lua`**: hyÃ¶dyllinen kotiohjaamoissa, telemetriassa ja ulkoisissa sovelluksissa; se on eri kerros kuin MSE.

## Seuraavaksi

Luku 02 kattaa:

- KÃ¤ytÃ¤nnÃ¶n tyÃ¶putken (VS Code).
- MitÃ¤ pitÃ¤Ã¤ (ja ei pidÃ¤) asentaa Luaâ€‘tyÃ¶skentelyyn.
- YleisimmÃ¤t kirjastot (MIST/MOOSE ja muut) ja milloin niistÃ¤ on hyÃ¶tyÃ¤.

## Navigointi

Seuraava: [Luku 02](ch02.fi.md)
